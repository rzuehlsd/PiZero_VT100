//------------------------------------------------------------------------------
// Module:        VT100_FontConverter
// Description:   Declares helpers to convert VT100 ROM data into Circle fonts.
// Author:        R. Zuehlsdorff, ralf.zuehlsdorff@t-online.de
// Created:       2025-12-05
// License:       MIT License (https://opensource.org/license/mit/)
//------------------------------------------------------------------------------
// Change Log:
// 2025-12-05     R. Zuehlsdorff        Initial creation
//------------------------------------------------------------------------------

#include <circle/types.h>
#include <circle/font.h>
#include "VT100_FontConverter.h"
#include "TFontConverter.h"


namespace
{

// Storage for converted fonts
u16 vt100font_circle[128 * 20];           // 10×20 with CRT gaps (5,120 bytes)
u16 vt100font_circle_solid[128 * 20];     // 10×20 solid doubling (5,120 bytes)
u8 vt100font_circle_8x20[128 * 20];       // 8×20 simple version (2,560 bytes)

// Storage for converted DEC Special Graphics fonts
u16 vt100font_graphics_circle[31 * 20];          // 10×20 with CRT gaps (1,240 bytes)
u16 vt100font_graphics_circle_solid[31 * 20];    // 10×20 solid doubling (1,240 bytes)
u8  vt100font_graphics_circle_8x20[31 * 20];     // 8×20 simple version (620 bytes)

// Font structures for Circle
const TFont VT100Font10x20 = {
    10,                     // width: 10 pixels (requires unsigned short)
    20,                     // height: 20 scanlines (10 doubled)
    2,                      // extra_height: line spacing between text rows
    0,                      // first_char: ASCII 0 (includes control chars)
    127,                    // last_char: ASCII 127
    vt100font_circle        // data: pointer to converted font (CRT gaps)
};

const TFont VT100Font10x20Solid = {
    10,                         // width: 10 pixels (solid doubling variant)
    20,                         // height: 20 scanlines
    2,                          // extra_height
    0,                          // first_char
    127,                        // last_char
    vt100font_circle_solid      // data: solid scanlines
};

const TFont VT100Font8x20 = {
    8,                          // width: 8 pixels (fits in unsigned char)
    20,                         // height: 20 scanlines
    2,                          // extra_height: line spacing
    0,                          // first_char
    127,                        // last_char
    vt100font_circle_8x20       // data
};

// Graphics font structures for Circle
const TFont VT100GraphicsFont10x20 = {
    10,                             // width: 10 pixels
    20,                             // height: 20 scanlines
    2,                              // extra_height: line spacing
    0x60,                           // first_char: '`' (start of graphics range)
    0x7E,                           // last_char: '~' (end of graphics range)
    vt100font_graphics_circle       // data: converted graphics font (CRT gaps)
};

const TFont VT100GraphicsFont10x20Solid = {
    10,                             // width: 10 pixels (solid)
    20,                             // height: 20 scanlines
    2,                              // extra_height: line spacing
    0x60,                           // first_char: '`'
    0x7E,                           // last_char: '~'
    vt100font_graphics_circle_solid // data: solid graphics font
};

const TFont VT100GraphicsFont8x20 = {
    8,                                  // width: 8 pixels
    20,                                 // height: 20 scanlines
    2,                                  // extra_height: line spacing
    0x60,                               // first_char: '`'
    0x7E,                               // last_char: '~'
    vt100font_graphics_circle_8x20      // data
};

} // anonymous namespace

static boolean s_Converted = false;

const TFont &GetVT100Font(EFontSelection selection)
{
    if(!s_Converted)
    {
        ConvertVT100Font();
        s_Converted = true;
    }   

    switch (selection)
    {
    case EFontSelection::VT100Font8x20:
        return VT100Font8x20;
    case EFontSelection::VT100Font10x20:
        return VT100Font10x20;
    case EFontSelection::VT100Font10x20Solid:
        return VT100Font10x20Solid;
    case EFontSelection::VT100GraphicsFont8x20:
        return VT100GraphicsFont8x20;
    case EFontSelection::VT100GraphicsFont10x20:
        return VT100GraphicsFont10x20;
    case EFontSelection::VT100GraphicsFont10x20Solid:
        return VT100GraphicsFont10x20Solid;
    default:
        return VT100Font10x20;
    }
}

//
// VT100 Character Generator ROM (23-018E2-00)
// From Lars Brinkhoff's terminal-simulator project
// https://github.com/larsbrinkhoff/terminal-simulator/blob/master/vt100/rom.c
//
// Format: 128 characters × 16 bytes per character
// Each character: 10 bytes of font data + 6 bytes padding
// Each font byte represents one scanline (8 pixels, MSB = leftmost)
//
const u8 vt100font_rom[128 * 16] = {
  // 0x00 - NUL
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0,0,0,0,0,0x00,
  // 0x01 - Diamond (Ctrl-A)
  0x10,0x38,0x7C,0xFE,0x7C,0x38,0x10,0x00,0x00,0x00,0,0,0,0,0,0x00,
  // 0x02 - Checkerboard (Ctrl-B)
  0x92,0x44,0x92,0x44,0x92,0x44,0x92,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x03 - Ctrl-C
  0x88,0x88,0xF8,0x88,0x88,0x3E,0x08,0x08,0x08,0,0,0,0,0,0,0x00,
  // 0x04 - Ctrl-D
  0xF0,0x80,0xE0,0x80,0x9E,0x10,0x1C,0x10,0x10,0,0,0,0,0,0,0x00,
  // 0x05 - Ctrl-E
  0x78,0x80,0x80,0x78,0x3C,0x22,0x3C,0x22,0x22,0,0,0,0,0,0,0x00,
  // 0x06 - Ctrl-F
  0x80,0x80,0x80,0xF8,0x3E,0x20,0x3C,0x20,0x20,0,0,0,0,0,0,0x00,
  // 0x07 - Bullet (Ctrl-G / BEL)
  0x38,0x44,0x44,0x38,0x00,0x00,0x00,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x08 - Ctrl-H
  0x00,0x10,0x10,0xFE,0x10,0x10,0xFE,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x09 - Tab (Ctrl-I)
  0x88,0xC8,0xA8,0x98,0x88,0x20,0x20,0x20,0x3E,0,0,0,0,0,0,0x00,
  // 0x0A - Line Feed (Ctrl-J)
  0x88,0x88,0x50,0x20,0x3E,0x08,0x08,0x08,0x08,0,0,0,0,0,0,0x00,
  // 0x0B - Vertical Tab (Ctrl-K)
  0x10,0x10,0x10,0xF0,0x00,0x00,0x00,0x00,0x00,0,0,0,0,0,0,0x10,
  // 0x0C - Form Feed (Ctrl-L)
  0x00,0x00,0x00,0xF0,0x10,0x10,0x10,0x10,0x10,0,0,0,0,0,0,0x00,
  // 0x0D - Carriage Return (Ctrl-M)
  0x00,0x00,0x00,0x1F,0x10,0x10,0x10,0x10,0x10,0,0,0,0,0,0,0x00,
  // 0x0E - Ctrl-N
  0x10,0x10,0x10,0x1F,0x00,0x00,0x00,0x00,0x00,0,0,0,0,0,0,0x10,
  // 0x0F - Ctrl-O
  0x10,0x10,0x10,0xFF,0x10,0x10,0x10,0x10,0x10,0,0,0,0,0,0,0x10,
  // 0x10 - Ctrl-P
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0,0,0,0,0,0,0xFF,
  // 0x11 - Ctrl-Q
  0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x12 - Ctrl-R
  0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x13 - Ctrl-S
  0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x14 - Ctrl-T
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0,0,0,0,0,0,0x00,
  // 0x15 - Ctrl-U
  0x10,0x10,0x10,0x1F,0x10,0x10,0x10,0x10,0x10,0,0,0,0,0,0,0x10,
  // 0x16 - Ctrl-V
  0x10,0x10,0x10,0xF0,0x10,0x10,0x10,0x10,0x10,0,0,0,0,0,0,0x10,
  // 0x17 - Ctrl-W
  0x10,0x10,0x10,0xFF,0x00,0x00,0x00,0x00,0x00,0,0,0,0,0,0,0x10,
  // 0x18 - Ctrl-X
  0x00,0x00,0x00,0xFF,0x10,0x10,0x10,0x10,0x10,0,0,0,0,0,0,0x00,
  // 0x19 - Ctrl-Y
  0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0,0,0,0,0,0,0x10,
  // 0x1A - Up arrow (Ctrl-Z)
  0x02,0x08,0x20,0x80,0x20,0x08,0x02,0xFE,0x00,0,0,0,0,0,0,0x00,
  // 0x1B - Down arrow (ESC)
  0x80,0x20,0x08,0x02,0x08,0x20,0x80,0xFE,0x00,0,0,0,0,0,0,0x00,
  // 0x1C - Right arrow
  0x00,0x00,0xFE,0x24,0x24,0x24,0x44,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x1D - Left arrow
  0x02,0x04,0xFE,0x10,0xFE,0x40,0x80,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x1E - Ctrl-^
  0x1C,0x22,0x20,0xF8,0x20,0x78,0xA6,0x40,0x00,0,0,0,0,0,0,0x00,
  // 0x1F - Ctrl-_
  0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x20 - Space
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x21 - !
  0x10,0x10,0x10,0x10,0x10,0x00,0x10,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x22 - "
  0x24,0x24,0x24,0x00,0x00,0x00,0x00,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x23 - #
  0x48,0x48,0xFC,0x48,0xFC,0x48,0x48,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x24 - $
  0x10,0x7C,0x90,0x7C,0x12,0x7C,0x10,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x25 - %
  0xC2,0xC4,0x08,0x10,0x20,0x46,0x86,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x26 - &
  0x70,0x88,0x88,0x70,0x8A,0x84,0x7A,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x27 - '
  0x18,0x10,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x28 - (
  0x08,0x10,0x20,0x20,0x20,0x10,0x08,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x29 - )
  0x20,0x10,0x08,0x08,0x08,0x10,0x20,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x2A - *
  0x00,0x44,0x28,0xFE,0x28,0x44,0x00,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x2B - +
  0x00,0x10,0x10,0xFE,0x10,0x10,0x00,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x2C - ,
  0x00,0x00,0x00,0x00,0x00,0x30,0x20,0x40,0x00,0,0,0,0,0,0,0x00,
  // 0x2D - -
  0x00,0x00,0x00,0xFE,0x00,0x00,0x00,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x2E - .
  0x00,0x00,0x00,0x00,0x00,0x30,0x30,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x2F - /
  0x02,0x04,0x08,0x10,0x20,0x40,0x80,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x30 - 0
  0x38,0x44,0x82,0x82,0x82,0x44,0x38,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x31 - 1
  0x10,0x30,0x50,0x10,0x10,0x10,0x7C,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x32 - 2
  0x78,0x84,0x02,0x1C,0x60,0x80,0xFE,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x33 - 3
  0xFE,0x04,0x08,0x1C,0x02,0x82,0x7C,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x34 - 4
  0x08,0x18,0x28,0x48,0xFE,0x08,0x08,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x35 - 5
  0xFE,0x80,0xBC,0xC2,0x02,0x82,0x7C,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x36 - 6
  0x3C,0x42,0x80,0xBC,0xC2,0x42,0x3C,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x37 - 7
  0xFE,0x02,0x04,0x08,0x10,0x20,0x40,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x38 - 8
  0x7C,0x82,0x82,0x7C,0x82,0x82,0x7C,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x39 - 9
  0x78,0x84,0x86,0x7A,0x02,0x84,0x78,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x3A - :
  0x00,0x30,0x30,0x00,0x00,0x30,0x30,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x3B - ;
  0x00,0x30,0x30,0x00,0x00,0x30,0x20,0x40,0x00,0,0,0,0,0,0,0x00,
  // 0x3C - <
  0x02,0x08,0x20,0x80,0x20,0x08,0x02,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x3D - =
  0x00,0x00,0xFE,0x00,0xFE,0x00,0x00,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x3E - >
  0x80,0x20,0x08,0x02,0x08,0x20,0x80,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x3F - ?
  0x7C,0x82,0x0C,0x10,0x10,0x00,0x10,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x40 - @
  0x7C,0x82,0x8A,0x92,0x9C,0x80,0x7C,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x41 - A
  0x10,0x28,0x44,0x82,0xFE,0x82,0x82,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x42 - B
  0xFC,0x42,0x42,0x7C,0x42,0x42,0xFC,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x43 - C
  0x3C,0x42,0x80,0x80,0x80,0x42,0x3C,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x44 - D
  0xF8,0x44,0x42,0x42,0x42,0x44,0xF8,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x45 - E
  0xFE,0x80,0x80,0xF8,0x80,0x80,0xFE,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x46 - F
  0xFE,0x80,0x80,0xF8,0x80,0x80,0x80,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x47 - G
  0x3C,0x42,0x80,0x80,0x8E,0x42,0x3C,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x48 - H
  0x82,0x82,0x82,0xFE,0x82,0x82,0x82,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x49 - I
  0x7C,0x10,0x10,0x10,0x10,0x10,0x7C,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x4A - J
  0x0E,0x04,0x04,0x04,0x04,0x84,0x78,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x4B - K
  0x82,0x8C,0xB0,0xC0,0xB0,0x8C,0x82,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x4C - L
  0x80,0x80,0x80,0x80,0x80,0x80,0xFE,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x4D - M
  0x82,0xC6,0xAA,0x92,0x82,0x82,0x82,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x4E - N
  0x82,0xC2,0xA2,0x92,0x8A,0x86,0x82,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x4F - O
  0x7C,0x82,0x82,0x82,0x82,0x82,0x7C,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x50 - P
  0xFC,0x82,0x82,0xFC,0x80,0x80,0x80,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x51 - Q
  0x7C,0x82,0x82,0x82,0x8A,0x84,0x7A,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x52 - R
  0xFC,0x82,0x82,0xFC,0x88,0x84,0x82,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x53 - S
  0x7C,0x82,0x80,0x7C,0x02,0x82,0x7C,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x54 - T
  0xFE,0x10,0x10,0x10,0x10,0x10,0x10,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x55 - U
  0x82,0x82,0x82,0x82,0x82,0x82,0x7C,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x56 - V
  0x82,0x82,0x44,0x44,0x28,0x28,0x10,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x57 - W
  0x82,0x82,0x82,0x92,0x92,0xAA,0x44,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x58 - X
  0x82,0x44,0x28,0x10,0x28,0x44,0x82,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x59 - Y
  0x82,0x44,0x28,0x10,0x10,0x10,0x10,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x5A - Z
  0xFE,0x04,0x08,0x10,0x20,0x40,0xFE,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x5B - [
  0x3C,0x20,0x20,0x20,0x20,0x20,0x3C,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x5C - backslash
  0x80,0x40,0x20,0x10,0x08,0x04,0x02,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x5D - ]
  0x78,0x08,0x08,0x08,0x08,0x08,0x78,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x5E - ^
  0x10,0x28,0x44,0x82,0x00,0x00,0x00,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x5F - _
  0x00,0x00,0x00,0x00,0x00,0x00,0xFE,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x60 - `
  0x30,0x10,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x61 - a
  0x00,0x00,0x7C,0x02,0x7E,0x82,0x7E,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x62 - b
  0x80,0x80,0xBC,0xC2,0x82,0xC2,0xBC,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x63 - c
  0x00,0x00,0x3C,0x42,0x80,0x40,0x3E,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x64 - d
  0x02,0x02,0x7A,0x86,0x82,0x86,0x7A,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x65 - e
  0x00,0x00,0x7C,0x82,0xFE,0x80,0x7C,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x66 - f
  0x1C,0x22,0x20,0xF8,0x20,0x20,0x20,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x67 - g
  0x00,0x02,0x7A,0x84,0x84,0x7C,0x04,0x84,0x78,0,0,0,0,0,0,0x00,
  // 0x68 - h
  0x80,0x80,0xBC,0xC2,0x82,0x82,0x82,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x69 - i
  0x10,0x00,0x30,0x10,0x10,0x10,0x7C,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x6A - j
  0x04,0x00,0x04,0x04,0x04,0x04,0x84,0x84,0x78,0,0,0,0,0,0,0x00,
  // 0x6B - k
  0x80,0x80,0x88,0x90,0xE0,0x88,0x82,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x6C - l
  0x30,0x10,0x10,0x10,0x10,0x10,0x38,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x6D - m
  0x00,0x00,0xC4,0xAA,0x92,0x92,0x82,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x6E - n
  0x00,0x00,0xBC,0xC2,0x82,0x82,0x82,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x6F - o
  0x00,0x00,0x7C,0x82,0x82,0x82,0x7C,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x70 - p
  0x00,0x00,0xBC,0xC2,0xC2,0xBC,0x80,0x80,0x80,0,0,0,0,0,0,0x00,
  // 0x71 - q
  0x00,0x00,0x7A,0x86,0x86,0x7A,0x02,0x02,0x02,0,0,0,0,0,0,0x00,
  // 0x72 - r
  0x00,0x00,0x9C,0x62,0x40,0x40,0x40,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x73 - s
  0x00,0x00,0x7C,0x80,0x7C,0x02,0xFC,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x74 - t
  0x20,0x20,0xF8,0x20,0x20,0x24,0x18,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x75 - u
  0x00,0x00,0x84,0x84,0x84,0x84,0x7A,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x76 - v
  0x00,0x00,0x82,0x82,0x44,0x28,0x10,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x77 - w
  0x00,0x00,0x82,0x82,0x92,0xAA,0x44,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x78 - x
  0x00,0x00,0x84,0x48,0x30,0x48,0x84,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x79 - y
  0x00,0x00,0x84,0x84,0x8C,0x74,0x04,0x84,0x78,0,0,0,0,0,0,0x00,
  // 0x7A - z
  0x00,0x00,0xFE,0x04,0x18,0x20,0xFE,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x7B - {
  0x0E,0x10,0x10,0x60,0x10,0x10,0x0E,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x7C - |
  0x10,0x10,0x10,0x00,0x00,0x10,0x10,0x10,0x00,0,0,0,0,0,0,0x00,
  // 0x7D - }
  0xE0,0x10,0x10,0x0C,0x10,0x10,0xE0,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x7E - ~
  0x62,0x92,0x8C,0x00,0x00,0x00,0x00,0x00,0x00,0,0,0,0,0,0,0x00,
  // 0x7F - DEL (usually displayed as a filled square or blank)
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0,0,0,0,0,0,0x00
};

// DEC Special Graphics ROM (31 chars: 0x60-0x7E)
// Mapping taken from VT100 line-drawing character set descriptions
const u8 vt100font_graphics[31 * 16] = {
    // 0x60 - Diamond (◆ U+25C6)
    0x00,0x10,0x28,0x44,0x82,0x44,0x28,0x10,0x00,0x00,0,0,0,0,0,0x00,
    // 0x61 - Checkerboard (▒ U+2592)
    0x55,0xAA,0x55,0xAA,0x55,0xAA,0x55,0xAA,0x55,0xAA,0,0,0,0,0,0x00,
    // 0x62 - HT symbol (not commonly used)
    0x10,0x38,0x54,0x10,0x10,0x10,0x10,0x10,0x00,0x00,0,0,0,0,0,0x00,
    // 0x63 - FF symbol (not commonly used)
    0x7C,0x40,0x40,0x78,0x40,0x40,0x40,0x40,0x00,0x00,0,0,0,0,0,0x00,
    // 0x64 - CR symbol (not commonly used)
    0x00,0x00,0xFE,0x04,0x04,0x3C,0x04,0x04,0x00,0x00,0,0,0,0,0,0x00,
    // 0x65 - LF symbol (not commonly used)
    0x10,0x10,0x10,0x10,0x10,0xFE,0x10,0x00,0x00,0x00,0,0,0,0,0,0x00,
    // 0x66 - Degree sign (° U+00B0)
    0x38,0x44,0x44,0x38,0x00,0x00,0x00,0x00,0x00,0x00,0,0,0,0,0,0x00,
    // 0x67 - Plus-minus (± U+00B1)
    0x00,0x10,0x10,0xFE,0x10,0x10,0x00,0xFE,0x00,0x00,0,0,0,0,0,0x00,
    // 0x68 - NL symbol (not commonly used)
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0,0,0,0,0,0x00,
    // 0x69 - VT symbol (not commonly used)
    0x10,0x10,0x10,0x10,0x10,0x10,0xFE,0x00,0x00,0x00,0,0,0,0,0,0x00,
    // 0x6A - Box corner up-left (┘ U+2518)
    0x00,0x00,0x00,0x00,0xFC,0x10,0x10,0x10,0x10,0x10,0,0,0,0,0,0x00,
    // 0x6B - Box corner down-left (┐ U+2510)
    0x10,0x10,0x10,0x10,0xFC,0x00,0x00,0x00,0x00,0x00,0,0,0,0,0,0x00,
    // 0x6C - Box corner down-right (┌ U+250C)
    0x10,0x10,0x10,0x10,0x1F,0x00,0x00,0x00,0x00,0x00,0,0,0,0,0,0x00,
    // 0x6D - Box corner up-right (└ U+2514)
    0x00,0x00,0x00,0x00,0x1F,0x10,0x10,0x10,0x10,0x10,0,0,0,0,0,0x00,
    // 0x6E - Box cross (┼ U+253C)
    0x10,0x10,0x10,0x10,0xFF,0x10,0x10,0x10,0x10,0x10,0,0,0,0,0,0x00,
    // 0x6F - Horizontal line scan 1 (top, ⎺ U+23BA)
    0xFE,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0,0,0,0,0,0x00,
    // 0x70 - Horizontal line scan 3 (⎻ U+23BB)
    0x00,0x00,0xFE,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0,0,0,0,0,0x00,
    // 0x71 - Horizontal line (─ U+2500)
    0x00,0x00,0x00,0x00,0xFE,0x00,0x00,0x00,0x00,0x00,0,0,0,0,0,0x00,
    // 0x72 - Horizontal line scan 7 (⎼ U+23BC)
    0x00,0x00,0x00,0x00,0x00,0x00,0xFE,0x00,0x00,0x00,0,0,0,0,0,0x00,
    // 0x73 - Horizontal line scan 9 (bottom, ⎽ U+23BD)
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFE,0x00,0,0,0,0,0,0x00,
    // 0x74 - Box tee right (├ U+251C)
    0x10,0x10,0x10,0x10,0x1F,0x10,0x10,0x10,0x10,0x10,0,0,0,0,0,0x00,
    // 0x75 - Box tee left (┤ U+2524)
    0x10,0x10,0x10,0x10,0xFC,0x10,0x10,0x10,0x10,0x10,0,0,0,0,0,0x00,
    // 0x76 - Box tee up (┴ U+2534)
    0x00,0x00,0x00,0x00,0xFF,0x10,0x10,0x10,0x10,0x10,0,0,0,0,0,0x00,
    // 0x77 - Box tee down (┬ U+252C)
    0x10,0x10,0x10,0x10,0xFF,0x00,0x00,0x00,0x00,0x00,0,0,0,0,0,0x00,
    // 0x78 - Vertical line (│ U+2502)
    0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0,0,0,0,0,0x00,
    // 0x79 - Less-than or equal (≤ U+2264)
    0x00,0x08,0x10,0x20,0x40,0x20,0x10,0x08,0x7C,0x00,0,0,0,0,0,0x00,
    // 0x7A - Greater-than or equal (≥ U+2265)
    0x00,0x40,0x20,0x10,0x08,0x10,0x20,0x40,0x7C,0x00,0,0,0,0,0,0x00,
    // 0x7B - Pi (π U+03C0)
    0x00,0x00,0xFE,0x92,0x92,0x92,0x92,0x92,0x00,0x00,0,0,0,0,0,0x00,
    // 0x7C - Not equal (≠ U+2260)
    0x00,0x02,0x04,0x7C,0x08,0x7C,0x20,0x40,0x00,0x00,0,0,0,0,0,0x00,
    // 0x7D - Pound sign (£ U+00A3)
    0x38,0x44,0x40,0xF0,0x40,0x40,0x44,0xFE,0x00,0x00,0,0,0,0,0,0x00,
    // 0x7E - Middle dot (· U+00B7)
    0x00,0x00,0x00,0x00,0x18,0x18,0x00,0x00,0x00,0x00,0,0,0,0,0,0x00
};

//
// Helper function: Apply VT100 dot stretcher effect
//
// The VT100 "dot stretcher" makes each lit pixel "bleed" to its right neighbor.
// This creates a smoother, more analog CRT appearance by reducing the visibility
// of individual pixels.
//
// Input:  8-bit pixel row from ROM (bit 7 = leftmost pixel, bit 0 = rightmost)
// Output: 10-bit stretched result (left-aligned in 16-bit word, MSB-first)
//
// Example:
//   Input:  0b10101000 (pixels at positions 0, 2, 4)
//   Output: 0b1110111000000000 (each pixel extended rightward)
//
static inline u16 ColumnMask(unsigned column)
{
    // Column 0 is the leftmost visible pixel. Pixels are stored right-aligned so
    // that bit (width-1-column) corresponds to the requested column.
    return static_cast<u16>(1u << (9u - column));
}

static u16 ApplyDotStretcher(u8 pixels8)
{
    u16 stretched = 0;

    // Duplicate each lit ROM pixel into two adjacent output columns. This mirrors
    // the VT100 hardware which effectively ORs the bit pattern at offsets 0 and 1
    // without shifting the glyph to the right.
    for (unsigned srcCol = 0; srcCol < 8; srcCol++) {
        if (pixels8 & (1u << (7u - srcCol))) {
            stretched |= ColumnMask(srcCol);
            if (srcCol + 1 < 10) {
                stretched |= ColumnMask(srcCol + 1);
            }
        }
    }

    return stretched;
}

//
// Helper function: Apply VT100 column extension
//
// The VT100 hardware had a feature where if the second-to-last column
// was lit, it would also light the last column. This creates rounder
// character edges, especially for curves and diagonals.
//
// Input:  10-bit pixel row (left-aligned in 16-bit word)
// Output: Same, but with column 9 lit if column 8 was lit
//
static u16 ApplyColumnExtension(u16 pixels10)
{
    const u16 col8Mask = ColumnMask(8);
    const u16 col9Mask = ColumnMask(9);

    if (pixels10 & col8Mask) {
        pixels10 |= col9Mask;
    }

    return pixels10;
}

static inline u16 StretchAndExtend(u8 pixels8)
{
    return ApplyColumnExtension(ApplyDotStretcher(pixels8));
}

static void BuildGraphicsPattern(unsigned codePoint, u8 (&lines)[10])
{
    constexpr unsigned kRowCount = 10;
    constexpr unsigned kMiddleRow = 4;
    constexpr u8 kVertical = 0x10;          // Center column
    constexpr u8 kHorizontalLeft = 0xF0;    // Horizontal from center to left
    constexpr u8 kHorizontalRight = 0x1F;   // Horizontal from center to right
    constexpr u8 kHorizontalFull = 0xFF;    // Horizontal both directions

    for (unsigned row = 0; row < kRowCount; ++row) {
        lines[row] = 0;
    }

    switch (codePoint)
    {
        case 0x6A: // 'j' - bottom-right corner
            for (unsigned row = 0; row < kMiddleRow; ++row) {
                lines[row] = kVertical;
            }
            lines[kMiddleRow] = kHorizontalLeft;
            break;

        case 0x6B: // 'k' - top-right corner
            lines[kMiddleRow] = kHorizontalLeft;
            for (unsigned row = kMiddleRow + 1; row < kRowCount; ++row) {
                lines[row] = kVertical;
            }
            break;

        case 0x6C: // 'l' - top-left corner
            lines[kMiddleRow] = kHorizontalRight;
            for (unsigned row = kMiddleRow + 1; row < kRowCount; ++row) {
                lines[row] = kVertical;
            }
            break;

        case 0x6D: // 'm' - bottom-left corner
            for (unsigned row = 0; row < kMiddleRow; ++row) {
                lines[row] = kVertical;
            }
            lines[kMiddleRow] = kHorizontalRight;
            break;

        case 0x6E: // 'n' - intersection
            for (unsigned row = 0; row < kRowCount; ++row) {
                lines[row] = kVertical;
            }
            lines[kMiddleRow] = kHorizontalFull;
            break;

        case 0x6F: // 'o' - scan line 1 (top)
            lines[0] = kHorizontalFull;
            break;

        case 0x70: // 'p' - scan line 3
            lines[2] = kHorizontalFull;
            break;

        case 0x71: // 'q' - horizontal line mid
            lines[kMiddleRow] = kHorizontalFull;
            break;

        case 0x72: // 'r' - scan line 7
            lines[6] = kHorizontalFull;
            break;

        case 0x73: // 's' - scan line 9
            lines[8] = kHorizontalFull;
            break;

        case 0x74: // 't' - tee right
            for (unsigned row = 0; row < kRowCount; ++row) {
                lines[row] = kVertical;
            }
            lines[kMiddleRow] = kHorizontalRight;
            break;

        case 0x75: // 'u' - tee left
            for (unsigned row = 0; row < kRowCount; ++row) {
                lines[row] = kVertical;
            }
            lines[kMiddleRow] = kHorizontalLeft;
            break;

        case 0x76: // 'v' - tee up
            for (unsigned row = 0; row < kMiddleRow; ++row) {
                lines[row] = kVertical;
            }
            lines[kMiddleRow] = kHorizontalFull;
            break;

        case 0x77: // 'w' - tee down
            lines[kMiddleRow] = kHorizontalFull;
            for (unsigned row = kMiddleRow + 1; row < kRowCount; ++row) {
                lines[row] = kVertical;
            }
            break;

        case 0x78: // 'x' - vertical line
            for (unsigned row = 0; row < kRowCount; ++row) {
                lines[row] = kVertical;
            }
            break;

        default:
        {
            const unsigned index = codePoint - 0x60;
            const u8 *pSrc = &vt100font_graphics[index * 16];
            for (unsigned line = 0; line < kRowCount; ++line) {
                lines[line] = pSrc[line];
            }
            break;
        }
    }
}

void ConvertVT100FontToCircle(void)
{
    for (unsigned ch = 0; ch < 128; ch++) {
        const u8 *pSrc = &vt100font_rom[ch * 16];
        u16 *pDst = &vt100font_circle[ch * 20];

        for (unsigned line = 0; line < 10; line++) {
            u16 pixels10 = StretchAndExtend(pSrc[line]);
            unsigned row = line * 2;

            pDst[row]     = pixels10;
            pDst[row + 1] = 0x0000;
        }
    }
}

void ConvertVT100FontToCircle_SolidDoubling(void)
{
    for (unsigned ch = 0; ch < 128; ch++) {
        const u8 *pSrc = &vt100font_rom[ch * 16];
        u16 *pDst = &vt100font_circle_solid[ch * 20];

        for (unsigned line = 0; line < 10; line++) {
            u16 pixels10 = StretchAndExtend(pSrc[line]);
            unsigned row = line * 2;

            pDst[row]     = pixels10;
            pDst[row + 1] = pixels10;
        }
    }
}

void ConvertVT100FontToCircle_8x20(void)
{
    for (unsigned ch = 0; ch < 128; ch++) {
        const u8 *pSrc = &vt100font_rom[ch * 16];
        u8 *pDst = &vt100font_circle_8x20[ch * 20];

        for (unsigned line = 0; line < 10; line++) {
            unsigned row = line * 2;

            pDst[row]     = pSrc[line];
            pDst[row + 1] = 0x00;
        }
    }
}

void ConvertVT100GraphicsToCircle(void)
{
    for (unsigned ch = 0; ch < 31; ch++) {
        u8 pattern[10];
        BuildGraphicsPattern(0x60 + ch, pattern);
        u16 *pDst = &vt100font_graphics_circle[ch * 20];

        for (unsigned line = 0; line < 10; line++) {
            u16 pixels10 = StretchAndExtend(pattern[line]);
            unsigned row = line * 2;

            pDst[row]     = pixels10;
            pDst[row + 1] = 0x0000;
        }
    }
}

void ConvertVT100GraphicsToCircle_SolidDoubling(void)
{
    for (unsigned ch = 0; ch < 31; ch++) {
        u8 pattern[10];
        BuildGraphicsPattern(0x60 + ch, pattern);
        u16 *pDst = &vt100font_graphics_circle_solid[ch * 20];

        for (unsigned line = 0; line < 10; line++) {
            u16 pixels10 = StretchAndExtend(pattern[line]);
            unsigned row = line * 2;

            pDst[row]     = pixels10;
            pDst[row + 1] = pixels10;
        }
    }
}

void ConvertVT100GraphicsToCircle_8x20(void)
{
    for (unsigned ch = 0; ch < 31; ch++) {
        u8 pattern[10];
        BuildGraphicsPattern(0x60 + ch, pattern);
        u8 *pDst = &vt100font_graphics_circle_8x20[ch * 20];

        for (unsigned line = 0; line < 10; line++) {
            unsigned row = line * 2;

            pDst[row]     = pattern[line];
            pDst[row + 1] = 0x00;
        }
    }
}

void ConvertVT100Font(void)
{
    ConvertVT100FontToCircle();
    ConvertVT100FontToCircle_SolidDoubling();
    ConvertVT100FontToCircle_8x20();

    ConvertVT100GraphicsToCircle();
    ConvertVT100GraphicsToCircle_SolidDoubling();
    ConvertVT100GraphicsToCircle_8x20();
}
