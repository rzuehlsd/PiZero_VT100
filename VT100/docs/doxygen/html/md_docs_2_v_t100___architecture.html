<!-- HTML header for doxygen 1.16.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.16.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>VT100 Terminal App: VT100 Architecture and Technical Implementation (VT100)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="custom.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function () {
  if (typeof mermaid === "undefined") {
    return;
  }
  document.querySelectorAll("pre.mermaid").forEach(function (block) {
    var container = document.createElement("div");
    container.className = "mermaid";
    container.textContent = block.textContent;
    block.parentNode.replaceChild(container, block);
  });
  mermaid.initialize({ startOnLoad: false, securityLevel: "loose" });
  mermaid.run({ querySelector: ".mermaid" });
});
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">VT100 Terminal App
   </div>
   <div id="projectbrief">Circle VT100 module documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.16.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('md_docs_2_v_t100___architecture.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">VT100 Architecture and Technical Implementation (VT100) </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="vt100-architecture-and-technical-implementation-vt100"></a></p>
<p>This is the single technical reference for developers. It combines architecture, dependency structure, runtime flow, and module-level implementation details that were previously spread across multiple documents.</p>
<h1 class="doxsection"><a class="anchor" id="table-of-contents-2"></a>
Table of Contents</h1>
<ul>
<li>1. Document role</li>
<li>2. Runtime module map (current)</li>
<li>3. Dependency graph (implementation-aligned)</li>
<li>4. Boot and initialization sequence</li>
<li>5. Task model and interaction pattern</li>
<li>6. Runtime data flows<ul>
<li>6.1 Keyboard to host flow</li>
<li>6.2 Host to display flow</li>
</ul>
</li>
<li>7. Setup subsystem details<ul>
<li>7.1 Legacy setup (F12)</li>
<li>7.2 Modern setup (F11)</li>
<li>7.3 Setup key handling specifics</li>
<li>7.4 Local mode (F10)</li>
</ul>
</li>
<li>8. Logging and network integration<ul>
<li>8.1 Sink selection model</li>
<li>8.2 File sink</li>
<li>8.3 WLAN/telnet sink</li>
<li>8.4 Kernel networking loop and lifecycle</li>
</ul>
</li>
<li>9. Font and rendering details<ul>
<li>9.1 DEC special graphics and charset switching</li>
</ul>
</li>
<li>10. HAL and buzzer details</li>
<li>11. Configuration persistence contract</li>
<li>12. Development notes</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md1-document-role"></a>
1. Document role</h1>
<p>Project documentation model:</p>
<ol type="1">
<li><span class="tt">README.md</span> — functional/user view</li>
<li><span class="tt">docs/VT100_Architecture.md</span> (this file) — technical architecture + implementation details</li>
<li><span class="tt">docs/Configuration_Guide.md</span> — configuration reference (user + admin/developer)</li>
<li><span class="tt">docs/Hardware.md</span> — carrier board and backplate hardware documentation</li>
</ol>
<h1 class="doxsection"><a class="anchor" id="autotoc_md2-runtime-module-map-current"></a>
2. Runtime module map (current)</h1>
<p>Primary modules in <span class="tt">VT100/src</span>:</p>
<ul>
<li><span class="tt">kernel.cpp</span> (<span class="tt"><a class="el" href="class_c_kernel.html" title="Central coordinator for hardware bring-up and runtime control.">CKernel</a></span>) — system bring-up, task orchestration, host routing</li>
<li><span class="tt">TConfig.cpp</span> (<span class="tt"><a class="el" href="class_c_t_config.html" title="Cooperative task responsible for configuration persistence and lookup.">CTConfig</a></span>) — defaults, parser, validation, persistence (<span class="tt">SD:/VT100.txt</span>)</li>
<li><span class="tt">TRenderer.cpp</span> (<span class="tt"><a class="el" href="class_c_t_renderer.html" title="Combines Circle framebuffer access with a VT100-aware state machine.">CTRenderer</a></span>) — framebuffer terminal rendering and cursor/attribute handling</li>
<li><span class="tt">TFontConverter.cpp</span> + <span class="tt">VT100_FontConverter.cpp</span> — VT100 font conversion and lookup</li>
<li><span class="tt">TKeyboard.cpp</span> (<span class="tt"><a class="el" href="class_c_t_keyboard.html" title="Cooperative task managing keyboard devices and event translation.">CTKeyboard</a></span>) — USB keyboard processing, repeat, line-ending conversion</li>
<li><span class="tt">TUART.cpp</span> (<span class="tt"><a class="el" href="class_c_t_u_a_r_t.html" title="Task responsible for UART initialization and data retrieval.">CTUART</a></span>) — serial init and polling read/write abstraction</li>
<li><span class="tt">TSetup.cpp</span> (<span class="tt"><a class="el" href="class_c_t_setup.html">CTSetup</a></span>) — legacy setup + modern setup dialog</li>
<li><span class="tt">TFileLog.cpp</span> (<span class="tt"><a class="el" href="class_c_t_file_log.html" title="Provides file-based persistence for Circle logger messages.">CTFileLog</a></span>) — SD log sink with fallback</li>
<li><span class="tt">TWlanLog.cpp</span> (<span class="tt"><a class="el" href="class_c_t_wlan_log.html" title="Network logging endpoint streaming log traffic to remote clients.">CTWlanLog</a></span>) — telnet/log sink + host bridge mode</li>
<li><span class="tt">hal.cpp</span> (<span class="tt"><a class="el" href="class_c_h_a_l.html" title="Provides buzzer control, GPIO switching, and timing utilities.">CHAL</a></span>) — buzzer PWM and GPIO16 TX/RX switching</li>
<li><span class="tt">VTTest.cpp</span> — integrated terminal test runner</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md3-dependency-graph-implementation-aligned"></a>
3. Dependency graph (implementation-aligned)</h1>
<p> 
<pre class="mermaid">
graph TD
    CKernel --> CTConfig
    CKernel --> CTFontConverter
    CKernel --> CTRenderer
    CKernel --> CTKeyboard
    CKernel --> CTUART
    CKernel --> CTSetup
    CKernel --> CTFileLog
    CKernel --> CTWlanLog
    CKernel --> CHAL
    CKernel --> CVTTest

    CTSetup --> CTRenderer
    CTSetup --> CTConfig
    CTSetup --> CTKeyboard

    CTKeyboard --> CTConfig
    CTRenderer --> CTConfig
    CTRenderer --> CTFontConverter

    CTFileLog --> CLogger
    CTWlanLog --> CLogger
    CTWlanLog --> CNetSubSystem
    CTWlanLog --> CWPASupplicant

    CTUART --> CSerialDevice
    CTRenderer --> CBcmFrameBuffer
</pre>
</p>
<p>Notes:</p>
<ul>
<li><span class="tt"><a class="el" href="class_c_kernel.html" title="Central coordinator for hardware bring-up and runtime control.">CKernel</a></span> remains the integration hub and lifecycle owner of singleton task modules.</li>
<li><span class="tt"><a class="el" href="class_c_t_config.html" title="Cooperative task responsible for configuration persistence and lookup.">CTConfig</a></span> is the runtime configuration source of truth.</li>
<li><span class="tt"><a class="el" href="class_c_t_setup.html">CTSetup</a></span> edits runtime configuration through <span class="tt"><a class="el" href="class_c_t_config.html" title="Cooperative task responsible for configuration persistence and lookup.">CTConfig</a></span> setters and persists changes with <span class="tt">SaveToFile()</span>.</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md4-boot-and-initialization-sequence"></a>
4. Boot and initialization sequence</h1>
<p><span class="tt">main.cpp</span> calls <span class="tt"><a class="el" href="class_c_kernel.html#ae767168897a124e4f24f5a3b2955c4f3" title="Initialize all VT100 subsystems and dependencies.">CKernel::Initialize()</a></span> then <span class="tt"><a class="el" href="class_c_kernel.html#a35b1e3c0aa496ac1eec6a70be56c1f6e" title="Enter the cooperative scheduler and main control loop.">CKernel::Run()</a></span>.</p>
<p>Current initialization order in <span class="tt"><a class="el" href="class_c_kernel.html#ae767168897a124e4f24f5a3b2955c4f3" title="Initialize all VT100 subsystems and dependencies.">CKernel::Initialize()</a></span>:</p>
<ol type="1">
<li>Screen and logger base services</li>
<li>Interrupt/timer/USB/HAL</li>
<li>SD/EMMC mount (<span class="tt">SD:</span>)</li>
<li><span class="tt"><a class="el" href="class_c_t_config.html" title="Cooperative task responsible for configuration persistence and lookup.">CTConfig</a></span> initialize + load (<span class="tt">SD:/VT100.txt</span>)</li>
<li>Apply config-coupled hardware/log state</li>
<li>Font converter, renderer, keyboard, UART, setup, test modules</li>
<li>Optional WLAN log/telnet initialization</li>
<li>Start periodic task and continue to runtime loop</li>
</ol>
<p> 
<pre class="mermaid">
sequenceDiagram
    participant Main as main.cpp
    participant Kernel as CKernel
    participant Config as CTConfig
    participant Font as CTFontConverter
    participant Renderer as CTRenderer
    participant Keyboard as CTKeyboard
    participant UART as CTUART
    participant Setup as CTSetup
    participant Wlan as CTWlanLog

    Main->>Kernel: Initialize()
    Kernel->>Config: Initialize()
    Kernel->>Config: LoadFromFile()
    Kernel->>Font: Initialize()
    Kernel->>Renderer: Initialize()
    Kernel->>Keyboard: Configure(callbacks)
    Kernel->>Keyboard: Initialize()
    Kernel->>UART: Initialize(&interrupt, nullptr)
    Kernel->>Setup: Initialize(renderer, config, keyboard)
    alt WLAN logging enabled
        Kernel->>Wlan: Initialize(..., port 2323, fallback)
    end
    Main->>Kernel: Run()
</pre>
</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md5-task-model-and-interaction-pattern"></a>
5. Task model and interaction pattern</h1>
<p>The refactoring model captured in <span class="tt">docs/Refactoring_Note.md</span> is retained where it still matches code:</p>
<ul>
<li>singleton access per subsystem (<span class="tt">Get()</span>)</li>
<li>explicit <span class="tt">Initialize()</span> stage before task activity</li>
<li>cooperative task execution (<span class="tt">CTask</span> + scheduler yielding)</li>
<li>kernel-owned callback registration for keyboard/raw-key routing</li>
</ul>
<p>Implementation notes aligned with current code:</p>
<ul>
<li><span class="tt"><a class="el" href="class_c_t_renderer.html" title="Combines Circle framebuffer access with a VT100-aware state machine.">CTRenderer</a></span> uses <span class="tt">TASK_LEVEL</span> spin locking to avoid long interrupt suppression during heavy framebuffer operations.</li>
<li><span class="tt"><a class="el" href="class_c_t_u_a_r_t.html" title="Task responsible for UART initialization and data retrieval.">CTUART</a></span> task exists but serial data path is polled by kernel via <span class="tt">DrainSerialInput()</span>.</li>
<li>kernel run loop services serial, optional networking, scheduler yield, and HAL updates.</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md6-runtime-data-flows"></a>
6. Runtime data flows</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md61-keyboard-to-host-flow"></a>
6.1 Keyboard to host flow</h2>
<ul>
<li>keyboard HID event → <span class="tt"><a class="el" href="class_c_t_keyboard.html" title="Cooperative task managing keyboard devices and event translation.">CTKeyboard</a></span></li>
<li><span class="tt"><a class="el" href="class_c_t_keyboard.html" title="Cooperative task managing keyboard devices and event translation.">CTKeyboard</a></span> applies line-ending mode from <span class="tt"><a class="el" href="class_c_t_config.html" title="Cooperative task responsible for configuration persistence and lookup.">CTConfig</a></span></li>
<li>kernel <span class="tt">onKeyPressed()</span> checks runtime local mode first</li>
<li>when local mode is ON: keyboard text is looped directly to renderer</li>
<li>when local mode is OFF: routing continues via <span class="tt">SendHostOutput()</span></li>
<li>destination:<ul>
<li>WLAN host mode active: TCP client</li>
<li>else: UART TX</li>
</ul>
</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md62-host-to-display-flow"></a>
6.2 Host to display flow</h2>
<ul>
<li>UART RX polling path: kernel <span class="tt">ProcessSerial()</span> → renderer write</li>
<li>WLAN host mode RX path: <span class="tt">HandleWlanHostRx()</span> → renderer write</li>
<li>setup visibility guard: serial/host rendering is suppressed while setup overlay is visible</li>
</ul>
<p> 
<pre class="mermaid">
sequenceDiagram
    participant HID as USB Keyboard
    participant Kbd as CTKeyboard
    participant Kcb as kernel onKeyPressed
    participant Router as CKernel::SendHostOutput
    participant Uart as CTUART
    participant Wlan as CTWlanLog
    participant Rndr as CTRenderer

    HID->>Kbd: key event
    Kbd->>Kcb: translated text
    Kcb->>Router: SendHostOutput()
    alt WLAN host mode active
        Router->>Wlan: SendHostData()
    else UART mode
        Router->>Uart: Send()
    end

    Uart-->>Router: DrainSerialInput()
    Router->>Rndr: Write(serial bytes)

    Wlan-->>Router: HandleWlanHostRx()
    Router->>Rndr: Write(host bridge bytes)
</pre>
</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md7-setup-subsystem-details"></a>
7. Setup subsystem details</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md71-legacy-setup-f12"></a>
7.1 Legacy setup (F12)</h2>
<ul>
<li>trigger: raw HID key <span class="tt">0x45</span></li>
<li>behavior: Setup A/B compatibility flow</li>
<li>page transitions: header rendering normalizes ANSI/DEC attribute, charset, and width state before drawing (prevents style leakage between Setup A and Setup B)</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md72-modern-setup-f11"></a>
7.2 Modern setup (F11)</h2>
<ul>
<li>trigger: raw HID key <span class="tt">0x44</span> or <span class="tt">CTSetup::ShowModern()</span></li>
<li>rendering: DEC graphics frame (<span class="tt">ESC ( 0</span>), centered double-width/bold title, three-column parameter/value/description rows</li>
<li>controls:<ul>
<li>Up/Down select row</li>
<li>Left/Right edit value</li>
<li>Enter save + persist + exit</li>
<li>Esc cancel + exit</li>
</ul>
</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md73-setup-key-handling-specifics"></a>
7.3 Setup key handling specifics</h2>
<p>Handled navigation sequences in setup input path:</p>
<ul>
<li><span class="tt">ESC [ A</span>, <span class="tt">ESC [ B</span>, <span class="tt">ESC [ C</span>, <span class="tt">ESC [ D</span>, <span class="tt">ESC [ H</span>, <span class="tt">ESC [ F</span></li>
</ul>
<p>Keyboard auto-repeat currently includes:</p>
<ul>
<li>printable ASCII</li>
<li>newline / carriage return / backspace / delete chars</li>
<li>arrows (<span class="tt">ESC [ A/B/C/D</span>)</li>
<li>delete key (<span class="tt">ESC [ 3 ~</span>)</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md74-local-mode-f10"></a>
7.4 Local mode (F10)</h2>
<ul>
<li>trigger: raw HID key <span class="tt">0x43</span></li>
<li>runtime action: toggles <span class="tt"><a class="el" href="class_c_kernel.html" title="Central coordinator for hardware bring-up and runtime control.">CKernel</a></span> local mode state</li>
<li>ON behavior: keypress text is written directly to <span class="tt"><a class="el" href="class_c_t_renderer.html" title="Combines Circle framebuffer access with a VT100-aware state machine.">CTRenderer</a></span></li>
<li>OFF behavior: keypress text follows standard host routing (WLAN host mode/UART)</li>
<li>UX feedback: renderer prints <span class="tt">VT100 local mode ON/OFF</span> when toggled</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md8-logging-and-network-integration"></a>
8. Logging and network integration</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md81-sink-selection-model"></a>
8.1 Sink selection model</h2>
<p><span class="tt"><a class="el" href="class_c_t_config.html#ac38082690dbdb38b325ec6890e7d7fbf" title="Decode the log output bitmask into individual booleans.">CTConfig::ResolveLogOutputs()</a></span> decodes <span class="tt">log_output</span> into sink flags:</p>
<ul>
<li>screen</li>
<li>file (<span class="tt"><a class="el" href="class_c_t_file_log.html" title="Provides file-based persistence for Circle logger messages.">CTFileLog</a></span>)</li>
<li>WLAN (<span class="tt"><a class="el" href="class_c_t_wlan_log.html" title="Network logging endpoint streaming log traffic to remote clients.">CTWlanLog</a></span>)</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md82-file-sink"></a>
8.2 File sink</h2>
<p><span class="tt"><a class="el" href="class_c_t_file_log.html" title="Provides file-based persistence for Circle logger messages.">CTFileLog</a></span>:</p>
<ul>
<li>writes to <span class="tt">SD:/&lt;log_filename&gt;</span></li>
<li>recreates file at startup</li>
<li>writes header + compile stamp</li>
<li>flushes by thresholds and on stop</li>
<li>forwards to fallback sink</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md83-wlantelnet-sink"></a>
8.3 WLAN/telnet sink</h2>
<p><span class="tt"><a class="el" href="class_c_t_wlan_log.html" title="Network logging endpoint streaming log traffic to remote clients.">CTWlanLog</a></span>:</p>
<ul>
<li>listens on port <span class="tt">2323</span></li>
<li>supports command/log mode and host bridge mode on the same endpoint</li>
<li>supports auto host mode via <span class="tt">wlan_host_autostart=1</span></li>
<li>operator command workflow is documented in <span class="tt">README.md</span> section 9</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md84-kernel-networking-loop-and-lifecycle"></a>
8.4 Kernel networking loop and lifecycle</h2>
<p>Current kernel behavior aligned with implementation:</p>
<ul>
<li>starts in waiting state when WLAN logging is enabled (<span class="tt">MarkTelnetWaiting()</span>)</li>
<li>enables serial output when telnet is ready (<span class="tt">MarkTelnetReady()</span>)</li>
<li>processes <span class="tt">m_Net.Process()</span> during runtime loop</li>
<li>advertises mDNS endpoint once available and logs telnet command</li>
</ul>
<p>Important correction vs older planning text:</p>
<ul>
<li>there is no dedicated deferred-serial backlog queue with 4 KiB cap in current implementation; serial routing is controlled by readiness/host-mode guards in the run loop.</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md9-font-and-rendering-details"></a>
9. Font and rendering details</h1>
<p>Font modules:</p>
<ul>
<li><span class="tt">src/TFontConverter.cpp</span> (task wrapper + API)</li>
<li><span class="tt">src/VT100_FontConverter.cpp</span> (conversion/tables)</li>
<li><span class="tt"><a class="el" href="_t_font_converter_8h.html" title="Declares the task that prepares VT100 font assets for rendering.">include/TFontConverter.h</a></span> (<span class="tt">EFontSelection</span>)</li>
</ul>
<p>Current relevant font selections:</p>
<ul>
<li><span class="tt">1</span> <span class="tt">VT100Font8x20</span></li>
<li><span class="tt">2</span> <span class="tt">VT100Font10x20</span></li>
<li><span class="tt">3</span> <span class="tt">VT100Font10x20Solid</span></li>
<li>graphics variants: <span class="tt">6</span>, <span class="tt">8</span>, <span class="tt">10</span></li>
</ul>
<p>User-facing persisted selection currently uses <span class="tt">font_selection</span> values <span class="tt">1..3</span>.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md91-dec-special-graphics-and-charset-switching"></a>
9.1 DEC special graphics and charset switching</h2>
<p><span class="tt"><a class="el" href="class_c_t_renderer.html" title="Combines Circle framebuffer access with a VT100-aware state machine.">CTRenderer</a></span> implements ISO 2022 VT100 charset switching with explicit G0/G1 state tracking:</p>
<ul>
<li>Character set state:<ul>
<li><span class="tt">m_G0CharSet</span></li>
<li><span class="tt">m_G1CharSet</span></li>
<li><span class="tt">m_bUseG1</span> (active locking shift)</li>
</ul>
</li>
<li>Parser states include designator handling for G0/G1 (<span class="tt">StateG0</span>, <span class="tt">StateG1</span>).</li>
<li>Escape/control handling:<ul>
<li><span class="tt">ESC (</span> designates G0</li>
<li><span class="tt">ESC )</span> designates G1</li>
<li><span class="tt">SI</span> (<span class="tt">0x0F</span>) selects G0</li>
<li><span class="tt">SO</span> (<span class="tt">0x0E</span>) selects G1</li>
</ul>
</li>
<li>Designators:<ul>
<li><span class="tt">'A'</span> / <span class="tt">'B'</span> → US set</li>
<li><span class="tt">'0'</span> → DEC graphics set</li>
</ul>
</li>
</ul>
<p>Graphics rendering behavior:</p>
<ul>
<li>Renderer keeps a dedicated graphics char generator (<span class="tt">m_pGraphicsCharGen</span>) alongside the main generator.</li>
<li>When a main font is selected, a matching graphics font is derived (<span class="tt">8x20</span>, <span class="tt">10x20</span>, <span class="tt">10x20Solid</span> variants).</li>
<li>During <span class="tt">DisplayChar</span>, if the active set is graphics and input is in DEC graphics range (<span class="tt">0x60..0x7E</span>), rendering temporarily uses the graphics generator.</li>
</ul>
<p>State persistence behavior:</p>
<ul>
<li>Save/restore of renderer state includes <span class="tt">g0CharSet</span>, <span class="tt">g1CharSet</span>, and <span class="tt">useG1</span> so setup overlays and state transitions preserve active charset context.</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md10-hal-and-buzzer-details"></a>
10. HAL and buzzer details</h1>
<p><span class="tt"><a class="el" href="class_c_h_a_l.html" title="Provides buzzer control, GPIO switching, and timing utilities.">CHAL</a></span> implementation (replacing legacy app-level PWM module):</p>
<ul>
<li>GPIO12 buzzer output</li>
<li>software-timed 800 Hz PWM (<span class="tt">CUserTimer</span>)</li>
<li><span class="tt">BEEP()</span> (~250 ms), <span class="tt">Click()</span> (~25 ms)</li>
<li>volume driven by <span class="tt">buzzer_volume</span></li>
<li>key-click enable via <span class="tt">key_click</span></li>
<li>GPIO16 TX/RX switch via <span class="tt">switch_txrx</span></li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md11-configuration-persistence-contract"></a>
11. Configuration persistence contract</h1>
<p>Authoritative persisted key set is defined by <span class="tt"><a class="el" href="class_c_t_config.html#aad9a8e1abcc432d8a7547b1e03d10efb" title="Save current configuration values to persistent storage.">CTConfig::SaveToFile()</a></span>.</p>
<p>Persisted domains include serial framing, cursor/display mode, font/color, buzzer/keyboard behavior, repeat tuning, wiring switch, WLAN host-mode flag, and logging configuration.</p>
<p>Current persisted set also includes <span class="tt">smooth_scroll</span> (0/1), which controls renderer-side non-blocking smooth animation for single-line scroll operations.</p>
<p>Current persisted set also includes:</p>
<ul>
<li><span class="tt">wrap_around</span> (0/1) for right-margin wrap behavior</li>
<li><span class="tt">margin_bell</span> (0/1) for bell at right-margin minus 8 columns</li>
</ul>
<p>Setup B mapping note:</p>
<ul>
<li>Group 1, leftmost bit (mask <span class="tt">0x8</span>, VT100 “Scroll”) is wired to <span class="tt">smooth_scroll</span>.</li>
<li>Group 2, leftmost bit (mask <span class="tt">0x8</span>, VT100 “Bell”) is wired to <span class="tt">margin_bell</span>.</li>
<li>Group 3, second bit from left (mask <span class="tt">0x4</span>, VT100 “Wraparound”) is wired to <span class="tt">wrap_around</span>.</li>
</ul>
<p>For value semantics and user/admin guidance see <span class="tt">docs/Configuration_Guide.md</span>.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md12-development-notes"></a>
12. Development notes</h1>
<ul>
<li>QEMU-specific runtime/build fallback paths were intentionally removed from <span class="tt">VT100</span>.</li>
<li>Command mode and host bridge mode intentionally share the same telnet endpoint (<span class="tt">:2323</span>).</li>
<li>For configuration changes, keep <span class="tt"><a class="el" href="class_c_t_config.html" title="Cooperative task responsible for configuration persistence and lookup.">CTConfig</a></span> defaults/parser/setters/save format and <span class="tt">Configuration_Guide.md</span> in sync.</li>
<li><span class="tt">docs/Refactoring_Note.md</span> remains useful as historical refactoring context, but this file is the normative technical reference.</li>
</ul>
<p>Renderer behavior note (current implementation):</p>
<ul>
<li>Smooth scrolling is implemented for single-line scroll paths (<span class="tt">Scroll</span>, <span class="tt">InsertLines(1)</span>, <span class="tt">DeleteLines(1)</span>) with a tick-driven, non-blocking animation in the renderer update loop.</li>
<li>Reverse index (RI) scrolling triggers at the top of the active scroll region. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- HTML footer for doxygen 1.16.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.16.1 </li>
  </ul>
</div>
</body>
</html>
